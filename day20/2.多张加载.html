<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        div {
            margin: 500px auto;
        }

        div img {
            display: block;
            margin: auto;
            width: 300px;
            height: 200px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div>
        <img src="./default.jpg" alt="" true-img="./2.jpg" class="bg">
        <img src="./default.jpg" alt="" true-img="./2.jpg" class="bg">
        <img src="./default.jpg" alt="" true-img="./2.jpg" class="bg">
        <img src="./default.jpg" alt="" true-img="./2.jpg" class="bg">
        <img src="./default.jpg" alt="" true-img="./2.jpg" class="bg">



    </div>
</body>

</html>
<script src="./utils.js"></script>
<script>
    let imgs = document.getElementsByClassName("bg");
    //此函数就是判断每一张图片是否要加载

    function delay() {
        console.log(1);
        //当函数执行的时候，咱们去循环每一张图片，然后去判断每一张图片是否需要加载
        for (let i = 0; i < imgs.length; i++) {
            console.log(100);
            delayImg(imgs[i]);
        }
    }

    function delayImg(img) {
        // console.log(img);
        //  if(img.flag){
        //      return;
        //  }
        let imgH = img.offsetHeight;
        let imgT = utils.offset(img).top;

        let winH = utils.win("clientHeight");
        let winT = utils.win("scrollTop");

        if (winT + winH >= imgH + imgT) {

            let trueSrc = img.getAttribute("true-img");
            let newImg = new Image;
            newImg.src = trueSrc;

            newImg.onload = function () {

                img.src = trueSrc;
                img.className = "";
                // img.flag=true;
            }
        }

    }
    delay();
    window.onscroll = delay;
</script>